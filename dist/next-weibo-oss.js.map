{"version":3,"sources":["next-weibo-oss.js"],"names":[],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"next-weibo-oss.js","sourcesContent":["(function() {\n  var global = global || this || window || Function('return this')();\n  var nx = global.nx || require('@feizheng/next-js-core2');\n  var nxFileUpload = require('next-file-upload');\n  var NxWeiboToPics = require('next-weibo-to-pics');\n  var WEIBO_API = '/weibo_api/interface/pic_upload.php';\n  var WEIBO_IMG = 'https://ws2.sinaimg.cn';\n  var ROOT_COOKIE = '; Path=/;';\n\n  var NxWeiboOss = nx.declare('nx.WeiboOss', {\n    methods: {\n      init: function(inToken, inOptions) {\n        this._token = inToken;\n        this._options = inOptions;\n        this.initToken();\n      },\n      initToken: function() {\n        var subCookie = this._token;\n        if (typeof this._token !== 'string') {\n          subCookie = this._token.find(function(item) {\n            return item.indexOf('SUB=') > -1;\n          });\n        }\n        // SUB=_2A252mjcRDeRhGeBO7lAX8CzOyjSIHXVV7i_ZrDV8PUNbmtBeLVejkW9NReLbikXG3fXjOzUGTCZi9E5emuh2wIbb; Path=/;\n        global.document.cookie = subCookie.split(';')[0] + ROOT_COOKIE;\n      },\n      process: function(inResponse, inResolve, inReject) {\n        var _response = JSON.parse(inResponse.split('\\n')[2]);\n        var data = _response.data;\n        if (data.count > 0) {\n          var pics = NxWeiboToPics(data.pics);\n          var value = pics.map(function(item) {\n            item.type = item.pid.charAt(21) === 'g' ? 'gif' : 'jpg';\n            item.url = [WEIBO_IMG, '/large/', item.pid, '.', item.type].join('');\n            return item;\n          });\n          inResolve(value);\n        } else {\n          inReject(inResponse);\n        }\n      },\n      upload: function(inFile) {\n        var self = this;\n        return new Promise(function(resolve, reject) {\n          nxFileUpload(WEIBO_API, { pic1: inFile }).then(function(response) {\n            self.process(response, resolve, reject);\n          });\n        });\n      },\n      uploads: function(inFileList) {\n        var self = this;\n        var request = {};\n        var files = nx.slice(inFileList);\n        files.forEach(function(file, index) {\n          request['pic' + (index + 1)] = file;\n        });\n\n        return new Promise(function(resolve, reject) {\n          nxFileUpload(WEIBO_API, request).then(function(response) {\n            self.process(response, resolve, reject);\n          });\n        });\n      }\n    }\n  });\n\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = NxWeiboOss;\n  }\n})();\n"]}