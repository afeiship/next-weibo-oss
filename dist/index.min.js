/*!
 * name: @jswork/next-weibo-oss
 * description: Weibo oss for next api.
 * homepage: https://github.com/afeiship/next-weibo-oss
 * version: 1.0.0
 * date: 2020-11-22 16:47:29
 * license: MIT
 */
!function(){var i=i||this||window||Function("return this")(),t=i.nx||require("@jswork/next"),r=require("@jswork/next-file-upload"),o=require("@jswork/next-weibo-to-pics"),s="/weibo_api/interface/pic_upload.php",u="https://tva1.sinaimg.cn",n=t.declare("nx.WeiboOss",{methods:{init:function(n,i){this._token=n,this._options=i,this.initToken()},initToken:function(){var n=this._token;"string"!=typeof this._token&&(n=this._token.find(function(n){return-1<n.indexOf("SUB=")})),i.document.cookie=n.split(";")[0]+"; Path=/;"},process:function(n,i,t){var e=JSON.parse(n.split("\n")[2]).data;0<e.count?i(o(e.pics).map(function(n){return n.type="g"===n.pid.charAt(21)?"gif":"jpg",n.url=[u,"/large/",n.pid,".",n.type].join(""),n})):t(n)},upload:function(n){var e=this;return new Promise(function(i,t){r(s,{pic1:n}).then(function(n){e.process(n,i,t)})})},uploads:function(n){var e=this,o={};return t.slice(n).forEach(function(n,i){o["pic"+(i+1)]=n}),new Promise(function(i,t){r(s,o).then(function(n){e.process(n,i,t)})})}}});"undefined"!=typeof module&&module.exports&&(module.exports=n)}();